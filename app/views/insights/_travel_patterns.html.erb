<!-- When Do You Travel Card -->
<div class="card bg-base-200">
  <div class="card-body p-5">
    <h2 class="card-title text-lg flex items-center gap-2">
      <%= icon 'clock', class: 'w-5 h-5 text-primary' %>
      When Do You Travel?
    </h2>

    <!-- Time of Day Distribution -->
    <div class="mt-3">
      <div class="text-sm font-medium mb-2">TIME OF DAY DISTRIBUTION</div>
      <div class="space-y-1">
        <% time_labels = { 'night' => '00-06', 'morning' => '06-12', 'afternoon' => '12-18', 'evening' => '18-24' } %>
        <% %w[night morning afternoon evening].each do |period| %>
          <div class="flex items-center gap-2 text-xs">
            <span class="w-12 text-base-content/60"><%= time_labels[period] %></span>
            <progress class="progress progress-info flex-1 h-2"
                      value="<%= @time_of_day[period] || 0 %>" max="100"></progress>
            <span class="w-8 text-right text-base-content/60"><%= @time_of_day[period] || 0 %>%</span>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Day of Week + Seasonality -->
    <div class="grid grid-cols-2 gap-4 mt-4">
      <div>
        <div class="text-sm font-medium mb-2">DAY OF WEEK</div>
        <div class="flex gap-1">
          <% days = %w[Mon Tue Wed Thu Fri Sat Sun] %>
          <% max_distance = @day_of_week.max.to_f %>
          <% @day_of_week.each_with_index do |distance, idx| %>
            <% opacity = max_distance.positive? ? (0.4 + (distance / max_distance) * 0.6).round(2) : 0.4 %>
            <div class="flex-1 bg-info text-info-content rounded text-center py-1" style="opacity: <%= opacity %>">
              <div class="text-xs font-medium"><%= days[idx] %></div>
              <div class="text-xs"><%= number_to_human(distance / 1000.0, precision: 0, significant: false, units: { unit: '', thousand: 'k', million: 'M' }) %></div>
            </div>
          <% end %>
        </div>
      </div>
      <div>
        <div class="text-sm font-medium mb-2">SEASONALITY</div>
        <div class="space-y-1 text-sm">
          <% season_colors = { 'winter' => 'info', 'spring' => 'success', 'summer' => 'warning', 'fall' => 'error' } %>
          <% %w[winter spring summer fall].each do |season| %>
            <div class="flex items-center gap-2">
              <span class="w-14 capitalize"><%= season.capitalize %></span>
              <progress class="progress progress-<%= season_colors[season] %> flex-1 h-2"
                        value="<%= @seasonality[season] || 0 %>" max="100"></progress>
              <span class="w-10 text-right text-base-content/60"><%= @seasonality[season] || 0 %>%</span>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Insight Callout -->
<% insight_text = generate_travel_insight(@time_of_day, @day_of_week, @seasonality) %>
<% if insight_text.present? %>
  <div class="alert bg-warning/20 border border-warning/30">
    <div class="flex items-start gap-3">
      <%= icon 'lightbulb', class: 'w-5 h-5 text-warning' %>
      <div>
        <h3 class="font-bold text-warning">Insight</h3>
        <div class="text-sm"><%= insight_text %></div>
      </div>
    </div>
  </div>
<% end %>
