<%# Replay Panel - Bottom scrubber for navigating through location data by time %>
<div class="replay-panel hidden" data-maps--maplibre-target="replayPanel">
  <%# Close button %>
  <button type="button"
          class="replay-close"
          data-action="click->maps--maplibre#toggleReplay"
          title="Close replay"
          aria-label="Close replay">
    &times;
  </button>

  <%# Controls row: Day nav | Time display | Replay + Cycle controls %>
  <div class="replay-controls-row">
    <%# Left: Day navigation %>
    <div class="replay-day-nav">
      <button type="button"
              data-action="click->maps--maplibre#replayPrevDay"
              data-maps--maplibre-target="replayPrevDayButton"
              title="Previous day"
              aria-label="Previous day">
        &larr;
      </button>
      <div class="replay-day-info">
        <span class="replay-day-display" data-maps--maplibre-target="replayDayDisplay">
          No data loaded
        </span>
        <span class="replay-day-count" data-maps--maplibre-target="replayDayCount"></span>
      </div>
      <button type="button"
              data-action="click->maps--maplibre#replayNextDay"
              data-maps--maplibre-target="replayNextDayButton"
              title="Next day"
              aria-label="Next day">
        &rarr;
      </button>
    </div>

    <%# Center: Time display %>
    <div class="replay-time-block">
      <span class="replay-time-display" data-maps--maplibre-target="replayTimeDisplay" aria-live="polite">
        --:--
      </span>
      <span class="replay-speed-display" data-maps--maplibre-target="replaySpeedDisplay">
      </span>
      <span class="replay-data-indicator hidden" data-maps--maplibre-target="replayDataIndicator" role="status">
        No data
      </span>
    </div>

    <%# Right: Replay controls + Cycle controls %>
    <div class="replay-action-controls">
      <button type="button"
              class="replay-play-btn"
              data-maps--maplibre-target="replayPlayButton"
              data-action="click->maps--maplibre#replayTogglePlayback"
              title="Play/Pause"
              aria-label="Play or pause replay">
        <span class="play-icon" data-maps--maplibre-target="replayPlayIcon">&#9658;</span>
        <span class="pause-icon hidden" data-maps--maplibre-target="replayPauseIcon">&#10074;&#10074;</span>
      </button>
      <div class="replay-speed-control">
        <input type="range"
               class="replay-speed-slider"
               min="1"
               max="4"
               value="2"
               step="1"
               data-maps--maplibre-target="replaySpeedSlider"
               data-action="input->maps--maplibre#replaySpeedChange"
               title="Replay speed"
               aria-label="Replay speed">
        <span class="replay-speed-label" data-maps--maplibre-target="replaySpeedLabel">2x</span>
      </div>
      <div class="replay-cycle-controls hidden" data-maps--maplibre-target="replayCycleControls">
        <button type="button"
                data-action="click->maps--maplibre#replayCyclePrev"
                title="Previous point"
                aria-label="Previous point">
          &larr;
        </button>
        <span class="replay-point-counter" data-maps--maplibre-target="replayPointCounter">
          Point 1 of 1
        </span>
        <button type="button"
                data-action="click->maps--maplibre#replayCycleNext"
                title="Next point"
                aria-label="Next point">
          &rarr;
        </button>
      </div>
    </div>
  </div>

  <%# Scrubber with data density visualization %>
  <div class="replay-scrubber-wrapper">
    <span class="replay-time-label">00:00</span>
    <div class="replay-scrubber-track" data-maps--maplibre-target="replayScrubberTrack">
      <div class="replay-density-container" data-maps--maplibre-target="replayDensityContainer"></div>
      <input type="range"
             class="replay-scrubber"
             min="0"
             max="1439"
             value="720"
             data-maps--maplibre-target="replayScrubber"
             data-action="input->maps--maplibre#replayScrubberHover"
             aria-label="Replay scrubber - time of day">
    </div>
    <span class="replay-time-label">23:59</span>
  </div>
</div>
