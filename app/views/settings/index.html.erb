<% content_for :title, 'Settings' %>

<div class="min-h-content w-full my-5">
  <h1 class="text-3xl font-bold mb-6">User Settings</h1>
  <%= render 'settings/navigation' %>

  <div class="card bg-base-200 shadow-xl">
    <%= form_for :settings, url: settings_path, method: :patch, data: { turbo_method: :patch, turbo: false } do |f| %>
      <div class="card-body">
        <div class="space-y-8 animate-fade-in">
          <div>
            <h2 class="text-2xl font-bold mb-4 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-camera mr-2 text-primary">
                <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path>
                <circle cx="12" cy="13" r="3"></circle>
              </svg>Immich Integration
            </h2>
            <div class="bg-base-100 p-5 rounded-lg shadow-sm space-y-4">
              <div class="form-control w-full">
                <%= f.label :immich_url, class: 'label' do %>
                  <span class="label-text font-medium">Immich URL</span>
                <% end %>
                <%= f.url_field :immich_url, value: current_user.safe_settings.immich_url, class: "input input-bordered w-full pr-10", placeholder: 'http://192.168.0.1:2283' %>
                <span class="label-text-alt mt-1">The base URL of your Immich instance</span>
              </div>
              <div class="form-control w-full">
                <%= f.label :immich_api_key, class: 'label' do %>
                  <span class="label-text font-medium">Immich API Key</span>
                <% end %>
                <div class="relative">
                  <%= f.password_field :immich_api_key, value: current_user.safe_settings.immich_api_key, class: "input input-bordered w-full pr-10", placeholder: 'xxxxxxxxxxxxxx' %>
                </div>
                <span class="label-text-alt mt-1">Found in your Immich admin panel under API settings</span>
              </div>
              <%# <div class="flex justify-end">
                <button class="btn btn-sm btn-outline">Test Connection</button>
              </div> %>
            </div>
          </div>
          <div>
            <h2 class="text-2xl font-bold mb-4 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-camera mr-2 text-primary">
                <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path>
                <circle cx="12" cy="13" r="3"></circle>
              </svg>Photoprism Integration
            </h2>
            <div class="bg-base-100 p-5 rounded-lg shadow-sm space-y-4">
              <div class="form-control w-full">
                <%= f.label :photoprism_url, class: 'label' do %>
                  <span class="label-text font-medium">Photoprism URL</span>
                <% end %>
                <div class="relative">
                  <%= f.url_field :photoprism_url, value: current_user.safe_settings.photoprism_url, class: "input input-bordered w-full pr-10", placeholder: 'http://192.168.0.1:2342' %>
                </div>
                <span class="label-text-alt mt-1">The base URL of your Photoprism instance</span>
              </div>
              <div class="form-control w-full">
                <%= f.label :photoprism_api_key, class: 'label' do %>
                  <span class="label-text font-medium">Photoprism API Key</span>
                <% end %>
                <div class="relative">
                  <%= f.password_field :photoprism_api_key, value: current_user.safe_settings.photoprism_api_key, class: "input input-bordered w-full pr-10", placeholder: 'xxxxxxxxxxxxxx' %>
                </div>
                <span class="label-text-alt mt-1">Found in your Photoprism settings under Library</span>
              </div>
              <%# <div class="flex justify-end">
                <button class="btn btn-sm btn-outline">Test Connection</button>
              </div> %>
            </div>
          </div>

          <% unless DawarichSettings.self_hosted? %>
            <div>
              <h2 class="text-2xl font-bold mb-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link mr-2 text-primary">
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                </svg>Connected Accounts
              </h2>
              <div class="bg-base-100 p-5 rounded-lg shadow-sm space-y-4">
                <p class="text-sm text-base-content/70">
                  OAuth providers configured: <%= OMNIAUTH_PROVIDERS.map(&:to_s).join(', ').presence || 'None' %>
                </p>
              </div>
            </div>
          <% end %>
        </div>
        <div class="card-actions justify-end mt-6">
          <%= f.submit "Save changes", class: "btn btn-primary" %>
        </div>
      </div>
    <% end %>
  </div>
</div>
