---
openapi: 3.0.1
info:
  title: Dawarich API
  version: v1
  description: API for Dawarich, a self-hosted location history tracking application.
    Provides endpoints for managing location data, tracks, visits, statistics, and
    more.
paths:
  "/api/v1/areas":
    post:
      summary: Creates an area
      tags:
      - Areas
      description: Creates a new geographic area for the authenticated user
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '201':
          description: area created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    description: The ID of the area
                  name:
                    type: string
                    description: The name of the area
                  latitude:
                    oneOf:
                    - type: number
                    - type: string
                    description: The latitude of the area center
                  longitude:
                    oneOf:
                    - type: number
                    - type: string
                    description: The longitude of the area center
                  radius:
                    type: integer
                    description: The radius of the area in meters
                  user_id:
                    type: integer
                    description: The ID of the owning user
                  created_at:
                    type: string
                    format: date-time
                  updated_at:
                    type: string
                    format: date-time
        '422':
          description: invalid request
        '401':
          description: unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                area:
                  type: object
                  properties:
                    name:
                      type: string
                      example: Home
                      description: The name of the area
                    latitude:
                      type: number
                      example: 40.7128
                      description: The latitude of the area center
                    longitude:
                      type: number
                      example: -74.006
                      description: The longitude of the area center
                    radius:
                      type: number
                      example: 100
                      description: The radius of the area in meters
                  required:
                  - name
                  - latitude
                  - longitude
                  - radius
            examples:
              '0':
                summary: Creates an area
                value:
                  area:
                    name: Home
                    latitude: 40.7128
                    longitude: -74.006
                    radius: 100
    get:
      summary: Retrieves all areas
      tags:
      - Areas
      description: Returns all areas belonging to the authenticated user
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '200':
          description: areas found
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                      description: The ID of the area
                    name:
                      type: string
                      example: Home
                      description: The name of the area
                    latitude:
                      oneOf:
                      - type: number
                      - type: string
                      example: 40.7128
                      description: The latitude of the area center
                    longitude:
                      oneOf:
                      - type: number
                      - type: string
                      example: -74.006
                      description: The longitude of the area center
                    radius:
                      type: integer
                      example: 100
                      description: The radius of the area in meters
                  required:
                  - id
                  - name
                  - latitude
                  - longitude
                  - radius
        '401':
          description: unauthorized
  "/api/v1/areas/{id}":
    parameters:
    - name: id
      in: path
      required: true
      description: Area ID
      schema:
        type: integer
    get:
      summary: Retrieves a specific area
      tags:
      - Areas
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '200':
          description: area found
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    description: The ID of the area
                  name:
                    type: string
                    description: The name of the area
                  latitude:
                    oneOf:
                    - type: number
                    - type: string
                    description: The latitude of the area center
                  longitude:
                    oneOf:
                    - type: number
                    - type: string
                    description: The longitude of the area center
                  radius:
                    type: integer
                    description: The radius of the area in meters
        '404':
          description: area not found
        '401':
          description: unauthorized
    patch:
      summary: Updates an area
      tags:
      - Areas
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '200':
          description: area updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    description: The ID of the area
                  name:
                    type: string
                    description: The name of the area
                  latitude:
                    oneOf:
                    - type: number
                    - type: string
                    description: The latitude of the area center
                  longitude:
                    oneOf:
                    - type: number
                    - type: string
                    description: The longitude of the area center
                  radius:
                    type: integer
                    description: The radius of the area in meters
        '404':
          description: area not found
        '401':
          description: unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                area:
                  type: object
                  properties:
                    name:
                      type: string
                      description: The name of the area
                    latitude:
                      type: number
                      description: The latitude of the area center
                    longitude:
                      type: number
                      description: The longitude of the area center
                    radius:
                      type: number
                      description: The radius of the area in meters
    delete:
      summary: Deletes an area
      tags:
      - Areas
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '200':
          description: area deleted
        '404':
          description: area not found
        '401':
          description: unauthorized
  "/api/v1/countries/visited_cities":
    get:
      summary: Get visited cities by date range
      tags:
      - Countries
      description: Returns a list of visited cities and countries based on tracked
        points within the specified date range
      parameters:
      - name: api_key
        in: query
        required: true
        example: a1b2c3d4e5f6g7h8i9j0
        description: Your API authentication key
        schema:
          type: string
      - name: start_at
        in: query
        schema:
          type: string
          format: date
        required: true
        description: Start date in YYYY-MM-DD format
        example: '2023-01-01'
      - name: end_at
        in: query
        schema:
          type: string
          format: date
        required: true
        description: End date in YYYY-MM-DD format
        example: '2023-12-31'
      responses:
        '200':
          description: cities found
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    description: Array of countries and their visited cities
                    example:
                    - country: Germany
                      cities:
                      - city: Berlin
                        points: 4394
                        timestamp: 1724868369
                        stayed_for: 24490
                      - city: Munich
                        points: 2156
                        timestamp: 1724782369
                        stayed_for: 12450
                    - country: France
                      cities:
                      - city: Paris
                        points: 3267
                        timestamp: 1724695969
                        stayed_for: 18720
                    items:
                      type: object
                      properties:
                        country:
                          type: string
                          example: Germany
                        cities:
                          type: array
                          items:
                            type: object
                            properties:
                              city:
                                type: string
                                example: Berlin
                              points:
                                type: integer
                                example: 4394
                                description: Number of points in the city
                              timestamp:
                                type: integer
                                example: 1724868369
                                description: Timestamp of the last point in the city
                                  in seconds since Unix epoch
                              stayed_for:
                                type: integer
                                example: 24490
                                description: Number of minutes the user stayed in
                                  the city
        '400':
          description: bad request - missing parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: 'Missing required parameters: start_at, end_at'
  "/api/v1/digests":
    get:
      summary: Lists all yearly digests
      tags:
      - Digests
      description: Returns all yearly digests for the authenticated user and available
        years for generation
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '200':
          description: digests found
          content:
            application/json:
              schema:
                type: object
                properties:
                  digests:
                    type: array
                    description: List of yearly digests
                    items:
                      type: object
                      properties:
                        year:
                          type: integer
                          description: The year of the digest
                        distance:
                          type: integer
                          description: Total distance in meters
                        countriesCount:
                          type: integer
                          description: Number of countries visited
                        citiesCount:
                          type: integer
                          description: Number of cities visited
                        createdAt:
                          type: string
                          format: date-time
                          description: When the digest was generated
                  availableYears:
                    type: array
                    items:
                      type: integer
                    description: Years available for digest generation (no existing
                      digest yet)
        '401':
          description: unauthorized
    post:
      summary: Generates a yearly digest
      tags:
      - Digests
      description: Queues generation of a yearly digest for the specified year
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '202':
          description: digest generation queued
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Confirmation message
        '422':
          description: invalid year
        '401':
          description: unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                year:
                  type: integer
                  description: Year to generate digest for
                  example: 2024
              required:
              - year
  "/api/v1/digests/{year}":
    parameters:
    - name: year
      in: path
      required: true
      description: Year of the digest
      schema:
        type: integer
    get:
      summary: Retrieves a yearly digest
      tags:
      - Digests
      description: Returns detailed digest data for a specific year
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      - name: distance_unit
        in: query
        required: false
        description: 'Distance unit: km or mi (defaults to user setting)'
        schema:
          type: string
      responses:
        '200':
          description: digest found
          content:
            application/json:
              schema:
                type: object
                properties:
                  year:
                    type: integer
                    description: The year of the digest
                  distance:
                    type: object
                    description: Distance details
                    properties:
                      meters:
                        type: integer
                        description: Total distance in meters
                      converted:
                        type: number
                        description: Distance in the requested unit
                      unit:
                        type: string
                        description: Distance unit (km or mi)
                      comparisonText:
                        type: string
                        description: Fun comparison text
                  toponyms:
                    type: object
                    description: Countries and cities visited
                    properties:
                      countriesCount:
                        type: integer
                      citiesCount:
                        type: integer
                      countries:
                        type: array
                        items:
                          type: object
                          properties:
                            country:
                              type: string
                            cities:
                              type: array
                              items:
                                type: string
                  monthlyDistances:
                    type: object
                    description: Distance per month (keyed by month name)
                  timeSpentByLocation:
                    type: object
                    description: Time spent in each location
                  firstTimeVisits:
                    type: object
                    description: First-time country and city visits
                  yearOverYear:
                    type: object
                    nullable: true
                    description: Year-over-year comparison
                    properties:
                      distanceChangePercent:
                        type: number
                      countriesChange:
                        type: integer
                      citiesChange:
                        type: integer
                  allTimeStats:
                    type: object
                    description: All-time cumulative stats
                    properties:
                      totalCountries:
                        type: integer
                      totalCities:
                        type: integer
                      totalDistance:
                        type: string
                  travelPatterns:
                    type: object
                    description: Travel pattern analysis
                    properties:
                      timeOfDay:
                        type: object
                      seasonality:
                        type: object
                      activityBreakdown:
                        type: object
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time
        '404':
          description: digest not found
        '401':
          description: unauthorized
    delete:
      summary: Deletes a yearly digest
      tags:
      - Digests
      description: Deletes the digest for the specified year
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '204':
          description: digest deleted
        '404':
          description: digest not found
        '401':
          description: unauthorized
  "/api/v1/health":
    get:
      summary: Retrieves application status
      tags:
      - Health
      description: Returns the health status of the application. No authentication
        required.
      responses:
        '200':
          description: Healthy
          headers:
            X-Dawarich-Response:
              schema:
                type: string
                example: Hey, I'm alive!
              required: true
              description: 'Depending on the authentication status, the response will
                differ. If authenticated: ''Hey, I''m alive and authenticated!''.
                If not: ''Hey, I''m alive!''.'
            X-Dawarich-Version:
              schema:
                type: string
                example: 1.0.0
              required: true
              description: 'The version of the application, for example: 1.0.0'
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                    description: Application health status
  "/api/v1/insights":
    get:
      summary: Retrieves insights overview for a year
      tags:
      - Insights
      description: Returns aggregated insights including totals, activity heatmap,
        and available years
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      - name: year
        in: query
        required: false
        description: Year to get insights for (defaults to most recent year with data)
        schema:
          type: integer
      - name: distance_unit
        in: query
        required: false
        description: 'Distance unit: km or mi (defaults to user setting)'
        schema:
          type: string
      responses:
        '200':
          description: insights found
          content:
            application/json:
              schema:
                type: object
                properties:
                  year:
                    type: integer
                    description: The selected year
                  availableYears:
                    type: array
                    items:
                      type: integer
                    description: Years with available data
                  totals:
                    type: object
                    description: Aggregated totals for the year
                    properties:
                      totalDistance:
                        type: number
                        description: Total distance traveled
                      distanceUnit:
                        type: string
                        description: Unit of distance (km or mi)
                      countriesCount:
                        type: integer
                        description: Number of countries visited
                      citiesCount:
                        type: integer
                        description: Number of cities visited
                      countriesList:
                        type: array
                        items:
                          type: string
                        description: List of country names
                      daysTraveling:
                        type: number
                        description: Number of days with tracked movement
                      biggestMonth:
                        type: object
                        nullable: true
                        description: Month with most distance
                  activityHeatmap:
                    type: object
                    nullable: true
                    description: Activity heatmap data for the year
                    properties:
                      dailyData:
                        type: object
                        description: Daily activity data keyed by date
                      activityLevels:
                        type: object
                        description: Activity level thresholds
                      maxDistance:
                        type: number
                        description: Maximum daily distance
                      activeDays:
                        type: integer
                        description: Number of active days
                      currentStreak:
                        type: integer
                        description: Current consecutive active days
                      longestStreak:
                        type: integer
                        description: Longest consecutive active days
                      longestStreakStart:
                        type: string
                        nullable: true
                        description: Start date of longest streak
                      longestStreakEnd:
                        type: string
                        nullable: true
                        description: End date of longest streak
        '401':
          description: unauthorized
  "/api/v1/insights/details":
    get:
      summary: Retrieves detailed insights with comparisons and travel patterns
      tags:
      - Insights
      description: Returns year-over-year comparison and travel pattern analysis
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      - name: year
        in: query
        required: false
        description: Year to get details for
        schema:
          type: integer
      - name: distance_unit
        in: query
        required: false
        description: 'Distance unit: km or mi (defaults to user setting)'
        schema:
          type: string
      responses:
        '200':
          description: details found
          content:
            application/json:
              schema:
                type: object
                properties:
                  year:
                    type: integer
                    description: The selected year
                  comparison:
                    type: object
                    nullable: true
                    description: Year-over-year comparison (null if no previous year
                      data)
                    properties:
                      previousYear:
                        type: integer
                        description: The previous year compared against
                      distanceChangePercent:
                        type: number
                        description: Percentage change in distance
                      countriesChange:
                        type: integer
                        description: Change in countries visited
                      citiesChange:
                        type: integer
                        description: Change in cities visited
                      daysChange:
                        type: number
                        description: Change in days traveling
                  travelPatterns:
                    type: object
                    description: Travel pattern analysis
                    properties:
                      timeOfDay:
                        type: object
                        description: Distance distribution by time of day
                      dayOfWeek:
                        type: array
                        items:
                          type: integer
                        description: Distance by day of week (Mon-Sun)
                      seasonality:
                        type: object
                        description: Seasonal travel patterns
                      activityBreakdown:
                        type: object
                        description: Breakdown by transportation mode
                      topVisitedLocations:
                        type: array
                        description: Top 5 most visited locations
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            visitCount:
                              type: integer
                            totalDuration:
                              type: integer
        '401':
          description: unauthorized
  "/api/v1/locations":
    get:
      summary: Searches for location history near coordinates
      tags:
      - Locations
      description: Searches for tracked location points near the specified coordinates,
        optionally filtered by date range
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      - name: lat
        in: query
        format: float
        required: true
        description: Latitude coordinate to search near
        schema:
          type: number
      - name: lon
        in: query
        format: float
        required: true
        description: Longitude coordinate to search near
        schema:
          type: number
      - name: limit
        in: query
        required: false
        description: 'Maximum number of results (default: 50)'
        schema:
          type: integer
      - name: date_from
        in: query
        required: false
        description: Start date filter (YYYY-MM-DD)
        schema:
          type: string
      - name: date_to
        in: query
        required: false
        description: End date filter (YYYY-MM-DD)
        schema:
          type: string
      - name: radius_override
        in: query
        required: false
        description: Custom search radius in meters
        schema:
          type: integer
      responses:
        '200':
          description: locations found
          content:
            application/json:
              schema:
                type: object
                properties:
                  query:
                    type: object
                    nullable: true
                    description: The search query parameters used
                  locations:
                    type: array
                    description: Matching location groups
                    items:
                      type: object
                      properties:
                        place_name:
                          type: string
                          nullable: true
                          description: Reverse-geocoded place name
                        coordinates:
                          type: array
                          items:
                            type: number
                          description: "[latitude, longitude]"
                        address:
                          type: string
                          nullable: true
                          description: Full address
                        total_visits:
                          type: integer
                          description: Total number of visits
                        first_visit:
                          type: string
                          nullable: true
                          description: First visit date
                        last_visit:
                          type: string
                          nullable: true
                          description: Last visit date
                        visits:
                          type: array
                          items:
                            type: object
                          description: Individual visit details
                  total_locations:
                    type: integer
                    description: Total matching locations
                  search_metadata:
                    type: object
                    description: Search metadata and statistics
        '400':
          description: bad request - missing coordinates
        '401':
          description: unauthorized
  "/api/v1/locations/suggestions":
    get:
      summary: Get location suggestions from text search
      tags:
      - Locations
      description: Returns geocoded location suggestions based on a text search query
        (min 2 characters)
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      - name: q
        in: query
        required: true
        description: Search query (minimum 2 characters)
        schema:
          type: string
      responses:
        '200':
          description: suggestions found
          content:
            application/json:
              schema:
                type: object
                properties:
                  suggestions:
                    type: array
                    description: Matching location suggestions
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          description: Place name
                        address:
                          type: string
                          nullable: true
                          description: Full address
                        coordinates:
                          type: array
                          items:
                            type: number
                          description: "[latitude, longitude]"
                        type:
                          type: string
                          nullable: true
                          description: Place type (city, street, etc.)
        '401':
          description: unauthorized
  "/api/v1/maps/hexagons":
    get:
      summary: Retrieves hexagon grid data for the map
      tags:
      - Maps
      description: Returns hexagonal grid data for map visualization. Supports both
        authenticated access and public sharing via UUID.
      parameters:
      - name: api_key
        in: query
        required: false
        description: API Key (required for authenticated access, omit when using uuid)
        schema:
          type: string
      - name: uuid
        in: query
        required: false
        description: Sharing UUID for public access (alternative to api_key)
        schema:
          type: string
      - name: start_date
        in: query
        required: false
        description: Start date (ISO 8601 format)
        schema:
          type: string
      - name: end_date
        in: query
        required: false
        description: End date (ISO 8601 format)
        schema:
          type: string
      - name: year
        in: query
        required: false
        description: Year filter
        schema:
          type: integer
      - name: month
        in: query
        required: false
        description: Month filter (1-12)
        schema:
          type: integer
      responses:
        '200':
          description: hexagons found
        '401':
          description: unauthorized
  "/api/v1/maps/hexagons/bounds":
    get:
      summary: Retrieves geographic bounds for hexagon data
      tags:
      - Maps
      description: Returns the geographic bounding box for the user's location data
        within the specified date range
      parameters:
      - name: api_key
        in: query
        required: false
        description: API Key (required for authenticated access)
        schema:
          type: string
      - name: uuid
        in: query
        required: false
        description: Sharing UUID for public access
        schema:
          type: string
      - name: start_date
        in: query
        required: false
        description: Start date (ISO 8601 format)
        schema:
          type: string
      - name: end_date
        in: query
        required: false
        description: End date (ISO 8601 format)
        schema:
          type: string
      responses:
        '200':
          description: bounds found
        '401':
          description: unauthorized
  "/api/v1/overland/batches":
    post:
      summary: Creates a batch of points
      tags:
      - Batches
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '201':
          description: Batch of points created
        '401':
          description: Unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                locations:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                        example: Feature
                      geometry:
                        type: object
                        properties:
                          type:
                            type: string
                            example: Point
                          coordinates:
                            type: array
                            items:
                              type: number
                            example:
                            - 13.356718
                            - 52.502397
                      properties:
                        type: object
                        properties:
                          timestamp:
                            type: string
                            example: '2021-06-01T12:00:00Z'
                            description: Timestamp in ISO 8601 format
                          altitude:
                            type: number
                            example: 0
                            description: Altitude in meters
                          speed:
                            type: number
                            example: 0
                            description: Speed in meters per second
                          horizontal_accuracy:
                            type: number
                            example: 0
                            description: Horizontal accuracy in meters
                          vertical_accuracy:
                            type: number
                            example: 0
                            description: Vertical accuracy in meters
                          motion:
                            type: array
                            items:
                              type: string
                            example:
                            - walking
                            - running
                            - driving
                            - cycling
                            - stationary
                            description: 'Motion type, for example: automotive_navigation,
                              fitness, other_navigation or other'
                          activity:
                            type: string
                            example: unknown
                            description: 'Activity type, e.g.: automotive_navigation,
                              fitness, other_navigation or other'
                          desired_accuracy:
                            type: number
                            example: 0
                            description: Desired accuracy in meters
                          deferred:
                            type: number
                            example: 0
                            description: the distance in meters to defer location
                              updates
                          significant_change:
                            type: string
                            example: disabled
                            description: a significant change mode, disabled, enabled
                              or exclusive
                          locations_in_payload:
                            type: number
                            example: 1
                            description: the number of locations in the payload
                          device_id:
                            type: string
                            example: 'iOS device #166'
                            description: the device id
                          unique_id:
                            type: string
                            example: '1234567890'
                            description: the device's Unique ID as set by Apple
                          wifi:
                            type: string
                            example: unknown
                            description: the WiFi network name
                          battery_state:
                            type: string
                            example: unknown
                            description: the battery state, unknown, unplugged, charging
                              or full
                          battery_level:
                            type: number
                            example: 0
                            description: the battery level percentage, from 0 to 1
                    required:
                    - geometry
                    - properties
            examples:
              '0':
                summary: Creates a batch of points
                value:
                  locations:
                  - type: Feature
                    geometry:
                      type: Point
                      coordinates:
                      - 13.356718
                      - 52.502397
                    properties:
                      timestamp: '2021-06-01T12:00:00Z'
                      altitude: 0
                      speed: 0
                      horizontal_accuracy: 0
                      vertical_accuracy: 0
                      motion: []
                      pauses: false
                      activity: unknown
                      desired_accuracy: 0
                      deferred: 0
                      significant_change: unknown
                      locations_in_payload: 1
                      device_id: 'iOS device #166'
                      unique_id: '1234567890'
                      wifi: unknown
                      battery_state: unknown
                      battery_level: 0
  "/api/v1/owntracks/points":
    post:
      summary: Creates a point
      tags:
      - Points
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '200':
          description: Point created
        '401':
          description: Unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                batt:
                  type: number
                  description: Device battery level (percentage)
                lon:
                  type: number
                  description: Longitude coordinate
                acc:
                  type: number
                  description: Accuracy of position in meters
                bs:
                  type: number
                  description: Battery status (0=unknown, 1=unplugged, 2=charging,
                    3=full)
                inrids:
                  type: array
                  items:
                    type: string
                  description: Array of region IDs device is currently in
                BSSID:
                  type: string
                  description: Connected WiFi access point MAC address
                SSID:
                  type: string
                  description: Connected WiFi network name
                vac:
                  type: number
                  description: Vertical accuracy in meters
                inregions:
                  type: array
                  items:
                    type: string
                  description: Array of region names device is currently in
                lat:
                  type: number
                  description: Latitude coordinate
                topic:
                  type: string
                  description: MQTT topic in format owntracks/user/device
                t:
                  type: string
                  description: Type of message (p=position, c=circle, etc)
                conn:
                  type: string
                  description: Connection type (w=wifi, m=mobile, o=offline)
                m:
                  type: number
                  description: Motion state (0=stopped, 1=moving)
                tst:
                  type: number
                  description: Timestamp in Unix epoch time
                alt:
                  type: number
                  description: Altitude in meters
                _type:
                  type: string
                  description: Internal message type (usually "location")
                tid:
                  type: string
                  description: Tracker ID used to display the initials of a user
                _http:
                  type: boolean
                  description: Whether message was sent via HTTP (true) or MQTT (false)
                ghash:
                  type: string
                  description: Geohash of location
                isorcv:
                  type: string
                  description: ISO 8601 timestamp when message was received
                isotst:
                  type: string
                  description: ISO 8601 timestamp of the location fix
                disptst:
                  type: string
                  description: Human-readable timestamp of the location fix
              required:
              - lat
              - lon
              - tst
              - _type
            examples:
              '0':
                summary: Creates a point
                value:
                  batt: 85
                  lon: -74.006
                  acc: 8
                  bs: 2
                  inrids:
                  - 5f1d1b
                  BSSID: b0:f2:8:45:94:33
                  SSID: Home Wifi
                  vac: 3
                  inregions:
                  - home
                  lat: 40.7128
                  topic: owntracks/jane/iPhone 12 Pro
                  t: p
                  conn: w
                  m: 1
                  tst: 1706965203
                  alt: 41
                  _type: location
                  tid: RO
                  _http: true
                  ghash: u33d773
                  isorcv: '2024-02-03T13:00:03Z'
                  isotst: '2024-02-03T13:00:03Z'
                  disptst: '2024-02-03 13:00:03'
  "/api/v1/photos":
    get:
      summary: Lists photos
      tags:
      - Photos
      description: Returns photos from connected photo services (Immich, PhotoPrism)
        within a date range
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      - name: start_date
        in: query
        required: true
        description: Start date in ISO8601 format, e.g. 2024-01-01
        schema:
          type: string
      - name: end_date
        in: query
        required: true
        description: End date in ISO8601 format, e.g. 2024-01-02
        schema:
          type: string
      responses:
        '200':
          description: photos found
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      description: Photo ID from the source service
                    latitude:
                      type: number
                      format: float
                      description: Latitude where the photo was taken
                    longitude:
                      type: number
                      format: float
                      description: Longitude where the photo was taken
                    localDateTime:
                      type: string
                      format: date-time
                      description: Local date and time the photo was taken
                    originalFileName:
                      type: string
                      description: Original file name of the photo
                    city:
                      type: string
                      description: City where the photo was taken
                    state:
                      type: string
                      description: State/region where the photo was taken
                    country:
                      type: string
                      description: Country where the photo was taken
                    type:
                      type: string
                      enum:
                      - image
                      - video
                      description: Media type
                    orientation:
                      type: string
                      enum:
                      - portrait
                      - landscape
                      description: Photo orientation
                    source:
                      type: string
                      enum:
                      - immich
                      - photoprism
                      description: Photo source service
                  required:
                  - id
                  - latitude
                  - longitude
                  - localDateTime
                  - originalFileName
                  - city
                  - state
                  - country
                  - type
                  - source
  "/api/v1/photos/{id}/thumbnail":
    get:
      summary: Retrieves a photo thumbnail
      tags:
      - Photos
      description: Returns the thumbnail image data for a specific photo from the
        configured photo service
      parameters:
      - name: id
        in: path
        required: true
        description: Photo ID from the source service
        schema:
          type: string
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      - name: source
        in: query
        required: true
        description: Photo source (immich or photoprism)
        schema:
          type: string
      responses:
        '200':
          description: photo found
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: Photo ID
                  latitude:
                    type: number
                    format: float
                    description: Latitude
                  longitude:
                    type: number
                    format: float
                    description: Longitude
                  localDateTime:
                    type: string
                    format: date-time
                    description: Local date and time
                  originalFileName:
                    type: string
                    description: Original file name
                  city:
                    type: string
                    description: City
                  state:
                    type: string
                    description: State/region
                  country:
                    type: string
                    description: Country
                  type:
                    type: string
                    enum:
                    - IMAGE
                    - VIDEO
                    - image
                    - video
                    - raw
                    - live
                    - animated
                    description: Media type
                  orientation:
                    type: string
                    enum:
                    - portrait
                    - landscape
                    description: Orientation
                  source:
                    type: string
                    enum:
                    - immich
                    - photoprism
                    description: Source service
        '404':
          description: photo not found
  "/api/v1/places":
    get:
      summary: Retrieves all places for the authenticated user
      tags:
      - Places
      parameters:
      - name: api_key
        in: query
        required: true
        description: API key for authentication
        schema:
          type: string
      - name: tag_ids
        in: query
        items:
          type: integer
        required: false
        description: Filter places by tag IDs
        schema:
          type: array
      responses:
        '200':
          description: places found
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    latitude:
                      type: number
                      format: float
                    longitude:
                      type: number
                      format: float
                    source:
                      type: string
                    icon:
                      type: string
                      nullable: true
                    color:
                      type: string
                      nullable: true
                    visits_count:
                      type: integer
                    created_at:
                      type: string
                      format: date-time
                    tags:
                      type: array
                      items:
                        type: object
                        properties:
                          id:
                            type: integer
                          name:
                            type: string
                          icon:
                            type: string
                          color:
                            type: string
                  required:
                  - id
                  - name
                  - latitude
                  - longitude
        '401':
          description: unauthorized
    post:
      summary: Creates a place
      tags:
      - Places
      parameters:
      - name: api_key
        in: query
        required: true
        description: API key for authentication
        schema:
          type: string
      responses:
        '201':
          description: place created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  latitude:
                    type: number
                    format: float
                  longitude:
                    type: number
                    format: float
                  source:
                    type: string
                  icon:
                    type: string
                    nullable: true
                  color:
                    type: string
                    nullable: true
                  visits_count:
                    type: integer
                  created_at:
                    type: string
                    format: date-time
                  tags:
                    type: array
        '422':
          description: invalid request
        '401':
          description: unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                latitude:
                  type: number
                  format: float
                longitude:
                  type: number
                  format: float
                source:
                  type: string
                tag_ids:
                  type: array
                  items:
                    type: integer
              required:
              - name
              - latitude
              - longitude
  "/api/v1/places/nearby":
    get:
      summary: Searches for nearby places using Photon geocoding API
      tags:
      - Places
      parameters:
      - name: api_key
        in: query
        required: true
        description: API key for authentication
        schema:
          type: string
      - name: latitude
        in: query
        format: float
        required: true
        description: Latitude coordinate
        schema:
          type: number
      - name: longitude
        in: query
        format: float
        required: true
        description: Longitude coordinate
        schema:
          type: number
      - name: radius
        in: query
        format: float
        required: false
        description: 'Search radius in kilometers (default: 0.5)'
        schema:
          type: number
      - name: limit
        in: query
        required: false
        description: 'Maximum number of results (default: 10)'
        schema:
          type: integer
      responses:
        '200':
          description: nearby places found
          content:
            application/json:
              schema:
                type: object
                properties:
                  places:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        latitude:
                          type: number
                          format: float
                        longitude:
                          type: number
                          format: float
                        distance:
                          type: number
                          format: float
                        type:
                          type: string
        '401':
          description: unauthorized
  "/api/v1/places/{id}":
    parameters:
    - name: id
      in: path
      description: Place ID
      required: true
      schema:
        type: integer
    get:
      summary: Retrieves a specific place
      tags:
      - Places
      parameters:
      - name: api_key
        in: query
        required: true
        description: API key for authentication
        schema:
          type: string
      responses:
        '200':
          description: place found
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  latitude:
                    type: number
                    format: float
                  longitude:
                    type: number
                    format: float
                  source:
                    type: string
                  icon:
                    type: string
                    nullable: true
                  color:
                    type: string
                    nullable: true
                  visits_count:
                    type: integer
                  created_at:
                    type: string
                    format: date-time
                  tags:
                    type: array
        '404':
          description: place not found
        '401':
          description: unauthorized
    patch:
      summary: Updates a place
      tags:
      - Places
      parameters:
      - name: api_key
        in: query
        required: true
        description: API key for authentication
        schema:
          type: string
      responses:
        '200':
          description: place updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  latitude:
                    type: number
                    format: float
                  longitude:
                    type: number
                    format: float
                  tags:
                    type: array
        '404':
          description: place not found
        '422':
          description: invalid request
        '401':
          description: unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                latitude:
                  type: number
                  format: float
                longitude:
                  type: number
                  format: float
                tag_ids:
                  type: array
                  items:
                    type: integer
    delete:
      summary: Deletes a place
      tags:
      - Places
      parameters:
      - name: api_key
        in: query
        required: true
        description: API key for authentication
        schema:
          type: string
      responses:
        '204':
          description: place deleted
        '404':
          description: place not found
        '401':
          description: unauthorized
  "/api/v1/points/tracked_months":
    get:
      summary: Returns list of tracked years and months
      tags:
      - Points
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '200':
          description: years and months found
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    year:
                      type: integer
                      description: Year in YYYY format
                    months:
                      type: array
                      items:
                        type: string
                        description: Three-letter month abbreviation
                  required:
                  - year
                  - months
                example:
                - year: 2024
                  months:
                  - Jan
                  - Feb
                  - Mar
                  - Apr
                  - May
                  - Jun
                  - Jul
                  - Aug
                  - Sep
                  - Oct
                  - Nov
                  - Dec
        '401':
          description: unauthorized
  "/api/v1/points":
    get:
      summary: Retrieves all points
      tags:
      - Points
      description: Returns paginated location points for the authenticated user, optionally
        filtered by date range
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      - name: start_at
        in: query
        description: Start date (i.e. 2024-02-03T13:00:03Z or 2024-02-03)
        schema:
          type: string
      - name: end_at
        in: query
        description: End date (i.e. 2024-02-03T13:00:03Z or 2024-02-03)
        schema:
          type: string
      - name: page
        in: query
        required: false
        description: Page number
        schema:
          type: integer
      - name: per_page
        in: query
        required: false
        description: Number of points per page
        schema:
          type: integer
      - name: order
        in: query
        required: false
        description: Order of points, valid values are `asc` or `desc`
        schema:
          type: string
      responses:
        '200':
          description: points found
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      description: Unique point identifier
                    battery_status:
                      type: number
                      description: Battery status code
                    ping:
                      type: number
                      description: Ping value
                    battery:
                      type: number
                      description: Battery level
                    tracker_id:
                      type: string
                      description: Tracker identifier
                    topic:
                      type: string
                      description: MQTT topic
                    altitude:
                      type: number
                      description: Altitude in meters
                    longitude:
                      type: number
                      description: Longitude coordinate
                    velocity:
                      type: number
                      description: Velocity in km/h
                    trigger:
                      type: string
                      description: Trigger type
                    bssid:
                      type: string
                      description: WiFi access point MAC address
                    ssid:
                      type: string
                      description: WiFi network name
                    connection:
                      type: string
                      description: Connection type (w=wifi, m=mobile)
                    vertical_accuracy:
                      type: number
                      description: Vertical accuracy in meters
                    accuracy:
                      type: number
                      description: Horizontal accuracy in meters
                    timestamp:
                      type: number
                      description: Unix timestamp of the point
                    latitude:
                      type: number
                      description: Latitude coordinate
                    mode:
                      type: number
                      description: Tracking mode
                    inrids:
                      type: array
                      items:
                        type: string
                      description: Region IDs
                    in_regions:
                      type: array
                      items:
                        type: string
                      description: Region names
                    raw_data:
                      type: string
                      nullable: true
                      description: Raw data from the tracking device
                    import_id:
                      type: string
                      nullable: true
                      description: Import ID if point was imported
                    city:
                      type: string
                      nullable: true
                      description: Reverse-geocoded city name
                    country:
                      type: string
                      nullable: true
                      description: Reverse-geocoded country name
                    created_at:
                      type: string
                      description: Record creation timestamp
                    updated_at:
                      type: string
                      description: Record last update timestamp
                    user_id:
                      type: integer
                      description: Owning user ID
                    geodata:
                      type: string
                      nullable: true
                      description: Reverse-geocoded geodata
                    visit_id:
                      type: string
                      nullable: true
                      description: Associated visit ID
        '401':
          description: unauthorized
    post:
      summary: Creates a batch of points
      tags:
      - Points
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '200':
          description: Batch of points being processed
        '401':
          description: Unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                locations:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                      geometry:
                        type: object
                        properties:
                          type:
                            type: string
                            example: Point
                            description: the geometry type, always Point
                          coordinates:
                            type: array
                            items:
                              type: number
                              example:
                              - -122.40530871
                              - 37.74430413
                              description: the coordinates of the point, longitude
                                and latitude
                      properties:
                        type: object
                        properties:
                          timestamp:
                            type: string
                            example: '2025-01-17T21:03:01Z'
                            description: the timestamp of the point
                          horizontal_accuracy:
                            type: number
                            example: 5
                            description: the horizontal accuracy of the point in meters
                          vertical_accuracy:
                            type: number
                            example: -1
                            description: the vertical accuracy of the point in meters
                          altitude:
                            type: number
                            example: 0
                            description: the altitude of the point in meters
                          speed:
                            type: number
                            example: 92.088
                            description: the speed of the point in meters per second
                          speed_accuracy:
                            type: number
                            example: 0
                            description: the speed accuracy of the point in meters
                              per second
                          course_accuracy:
                            type: number
                            example: 0
                            description: the course accuracy of the point in degrees
                          track_id:
                            type: string
                            example: 799F32F5-89BB-45FB-A639-098B1B95B09F
                            description: the track id of the point set by the device
                          device_id:
                            type: string
                            example: 8D5D4197-245B-4619-A88B-2049100ADE46
                            description: the device id of the point set by the device
                    required:
                    - geometry
                    - properties
            examples:
              '0':
                summary: Creates a batch of points
                value:
                  locations:
                  - type: Feature
                    geometry:
                      type: Point
                      coordinates:
                      - -122.40530871
                      - 37.74430413
                    properties:
                      battery_state: full
                      battery_level: 0.7
                      wifi: dawarich_home
                      timestamp: '2025-01-17T21:03:01Z'
                      horizontal_accuracy: 5
                      vertical_accuracy: -1
                      altitude: 0
                      speed: 92.088
                      speed_accuracy: 0
                      course: 27.07
                      course_accuracy: 0
                      track_id: 799F32F5-89BB-45FB-A639-098B1B95B09F
                      device_id: 8D5D4197-245B-4619-A88B-2049100ADE46
  "/api/v1/points/{id}":
    delete:
      summary: Deletes a point
      tags:
      - Points
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      - name: id
        in: path
        required: true
        description: Point ID
        schema:
          type: string
      responses:
        '200':
          description: point deleted
        '401':
          description: unauthorized
  "/api/v1/settings":
    patch:
      summary: Updates user settings
      tags:
      - Settings
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '200':
          description: settings updated
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                route_opacity:
                  type: number
                  example: 60
                  description: Route opacity percentage (0-100)
                meters_between_routes:
                  type: number
                  example: 500
                  description: Minimum distance between routes in meters
                minutes_between_routes:
                  type: number
                  example: 30
                  description: Minimum time between routes in minutes
                fog_of_war_meters:
                  type: number
                  example: 50
                  description: Fog of war radius in meters
                time_threshold_minutes:
                  type: number
                  example: 30
                  description: Time threshold for grouping points in minutes
                merge_threshold_minutes:
                  type: number
                  example: 15
                  description: Threshold for merging nearby points in minutes
                preferred_map_layer:
                  type: string
                  example: OpenStreetMap
                  description: Preferred map layer/tile provider
                speed_colored_routes:
                  type: boolean
                  example: false
                  description: Whether to color routes based on speed
                points_rendering_mode:
                  type: string
                  example: raw
                  description: How to render points on the map (raw, heatmap, etc.)
                live_map_enabled:
                  type: boolean
                  example: true
                  description: Whether live map updates are enabled
                immich_url:
                  type: string
                  example: https://immich.example.com
                  description: Immich server URL for photo integration
                immich_api_key:
                  type: string
                  example: your-immich-api-key
                  description: API key for Immich photo service
                photoprism_url:
                  type: string
                  example: https://photoprism.example.com
                  description: PhotoPrism server URL for photo integration
                photoprism_api_key:
                  type: string
                  example: your-photoprism-api-key
                  description: API key for PhotoPrism photo service
                speed_color_scale:
                  type: string
                  example: viridis
                  description: Color scale for speed-colored routes
                fog_of_war_threshold:
                  type: number
                  example: 100
                  description: Fog of war threshold value
            examples:
              '0':
                summary: Updates user settings
                value:
                  settings:
                    route_opacity: 60
                    meters_between_routes: 500
                    minutes_between_routes: 30
                    fog_of_war_meters: 50
                    time_threshold_minutes: 30
                    merge_threshold_minutes: 15
                    preferred_map_layer: OpenStreetMap
                    speed_colored_routes: false
                    points_rendering_mode: raw
                    live_map_enabled: true
                    immich_url: https://immich.example.com
                    immich_api_key: your-immich-api-key
                    photoprism_url: https://photoprism.example.com
                    photoprism_api_key: your-photoprism-api-key
                    speed_color_scale: viridis
                    fog_of_war_threshold: 100
    get:
      summary: Retrieves user settings
      tags:
      - Settings
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '200':
          description: settings found
          content:
            application/json:
              schema:
                type: object
                properties:
                  settings:
                    type: object
                    properties:
                      route_opacity:
                        type: number
                        example: 60
                        description: Route opacity percentage (0-100)
                      meters_between_routes:
                        oneOf:
                        - type: number
                        - type: string
                        example: 500
                        description: Minimum distance between routes in meters
                      minutes_between_routes:
                        oneOf:
                        - type: number
                        - type: string
                        example: 30
                        description: Minimum time between routes in minutes
                      fog_of_war_meters:
                        oneOf:
                        - type: number
                        - type: string
                        example: 50
                        description: Fog of war radius in meters
                      time_threshold_minutes:
                        oneOf:
                        - type: number
                        - type: string
                        example: 30
                        description: Time threshold for grouping points in minutes
                      merge_threshold_minutes:
                        oneOf:
                        - type: number
                        - type: string
                        example: 15
                        description: Threshold for merging nearby points in minutes
                      preferred_map_layer:
                        type: string
                        example: OpenStreetMap
                        description: Preferred map layer/tile provider
                      speed_colored_routes:
                        type: boolean
                        example: false
                        description: Whether to color routes based on speed
                      points_rendering_mode:
                        type: string
                        example: raw
                        description: How to render points on the map (raw, heatmap,
                          etc.)
                      live_map_enabled:
                        type: boolean
                        example: true
                        description: Whether live map updates are enabled
                      immich_url:
                        oneOf:
                        - type: string
                        - type: 'null'
                        example: https://immich.example.com
                        description: Immich server URL for photo integration
                      immich_api_key:
                        oneOf:
                        - type: string
                        - type: 'null'
                        example: your-immich-api-key
                        description: API key for Immich photo service
                      photoprism_url:
                        oneOf:
                        - type: string
                        - type: 'null'
                        example: https://photoprism.example.com
                        description: PhotoPrism server URL for photo integration
                      photoprism_api_key:
                        oneOf:
                        - type: string
                        - type: 'null'
                        example: your-photoprism-api-key
                        description: API key for PhotoPrism photo service
                      speed_color_scale:
                        oneOf:
                        - type: string
                        - type: 'null'
                        example: viridis
                        description: Color scale for speed-colored routes
                      fog_of_war_threshold:
                        oneOf:
                        - type: number
                        - type: string
                        - type: 'null'
                        example: 100
                        description: Fog of war threshold value
  "/api/v1/stats":
    get:
      summary: Retrieves all stats
      tags:
      - Stats
      description: Returns aggregated statistics including total distance, points
        tracked, countries and cities visited, with yearly breakdowns
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '200':
          description: stats found
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalDistanceKm:
                    type: number
                    description: Total distance traveled in kilometers
                  totalPointsTracked:
                    type: number
                    description: Total number of location points tracked
                  totalReverseGeocodedPoints:
                    type: number
                    description: Total points with reverse geocoding data
                  totalCountriesVisited:
                    type: number
                    description: Total unique countries visited
                  totalCitiesVisited:
                    type: number
                    description: Total unique cities visited
                  yearlyStats:
                    type: array
                    description: Statistics broken down by year
                    items:
                      type: object
                      properties:
                        year:
                          type: integer
                          description: The year
                        totalDistanceKm:
                          type: number
                          description: Distance traveled in km for this year
                        totalCountriesVisited:
                          type: number
                          description: Countries visited this year
                        totalCitiesVisited:
                          type: number
                          description: Cities visited this year
                        monthlyDistanceKm:
                          type: object
                          description: Distance traveled per month in km
                          properties:
                            january:
                              type: number
                            february:
                              type: number
                            march:
                              type: number
                            april:
                              type: number
                            may:
                              type: number
                            june:
                              type: number
                            july:
                              type: number
                            august:
                              type: number
                            september:
                              type: number
                            october:
                              type: number
                            november:
                              type: number
                            december:
                              type: number
                      required:
                      - year
                      - totalDistanceKm
                      - totalCountriesVisited
                      - totalCitiesVisited
                      - monthlyDistanceKm
                required:
                - totalDistanceKm
                - totalPointsTracked
                - totalReverseGeocodedPoints
                - totalCountriesVisited
                - totalCitiesVisited
                - yearlyStats
        '401':
          description: unauthorized
  "/api/v1/tracks/{track_id}/points":
    parameters:
    - name: track_id
      in: path
      required: true
      description: Track ID
      schema:
        type: integer
    get:
      summary: Retrieves points for a track
      tags:
      - Tracks
      description: Returns location points belonging to a specific track, ordered
        by timestamp ascending
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      - name: page
        in: query
        required: false
        description: Page number (optional pagination)
        schema:
          type: integer
      - name: per_page
        in: query
        required: false
        description: Items per page (max 1000)
        schema:
          type: integer
      responses:
        '200':
          description: points found
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      description: Point ID
                    latitude:
                      type: string
                      nullable: true
                      description: Latitude coordinate
                    longitude:
                      type: string
                      nullable: true
                      description: Longitude coordinate
                    timestamp:
                      type: number
                      description: Unix timestamp
                    velocity:
                      type: number
                      nullable: true
                      description: Velocity in km/h
                    country_name:
                      type: string
                      nullable: true
                      description: Country name from reverse geocoding
        '404':
          description: track not found
        '401':
          description: unauthorized
  "/api/v1/tracks":
    get:
      summary: Retrieves tracks as GeoJSON
      tags:
      - Tracks
      description: Returns paginated tracks as a GeoJSON FeatureCollection with LineString
        geometries
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      - name: start_at
        in: query
        required: false
        description: Start date filter (ISO 8601 format)
        schema:
          type: string
      - name: end_at
        in: query
        required: false
        description: End date filter (ISO 8601 format)
        schema:
          type: string
      - name: page
        in: query
        required: false
        description: Page number
        schema:
          type: integer
      - name: per_page
        in: query
        required: false
        description: Items per page
        schema:
          type: integer
      responses:
        '200':
          description: tracks found
          content:
            application/json:
              schema:
                type: object
                properties:
                  type:
                    type: string
                    example: FeatureCollection
                    description: GeoJSON type
                  features:
                    type: array
                    description: Array of GeoJSON Feature objects
                    items:
                      type: object
                      properties:
                        type:
                          type: string
                          example: Feature
                        geometry:
                          type: object
                          properties:
                            type:
                              type: string
                              example: LineString
                            coordinates:
                              type: array
                              description: Array of [longitude, latitude] coordinate
                                pairs
                              items:
                                type: array
                                items:
                                  type: number
                        properties:
                          type: object
                          properties:
                            id:
                              type: integer
                              description: Track ID
                            color:
                              type: string
                              description: Display color for the track
                            start_at:
                              type: string
                              description: Track start time (ISO 8601)
                            end_at:
                              type: string
                              description: Track end time (ISO 8601)
                            distance:
                              type: number
                              description: Distance in meters
                            avg_speed:
                              type: number
                              description: Average speed in km/h
                            duration:
                              type: number
                              description: Duration in seconds
                            dominant_mode:
                              type: string
                              nullable: true
                              description: Primary transportation mode
                            dominant_mode_emoji:
                              type: string
                              nullable: true
                              description: Emoji for transportation mode
        '401':
          description: unauthorized
  "/api/v1/tracks/{id}":
    parameters:
    - name: id
      in: path
      required: true
      description: Track ID
      schema:
        type: integer
    get:
      summary: Retrieves a single track as GeoJSON
      tags:
      - Tracks
      description: Returns a single track as a GeoJSON FeatureCollection, including
        track segment details
      parameters:
      - name: api_key
        in: query
        required: true
        description: API Key
        schema:
          type: string
      responses:
        '200':
          description: track found
          content:
            application/json:
              schema:
                type: object
                properties:
                  type:
                    type: string
                    example: FeatureCollection
                  features:
                    type: array
                    items:
                      type: object
        '404':
          description: track not found
        '401':
          description: unauthorized
  "/api/v1/users/me":
    get:
      summary: Returns the current user
      tags:
      - Users
      security:
      - bearer_auth: []
      parameters:
      - name: Authorization
        in: header
        required: true
        description: 'Bearer token in the format: Bearer {api_key}'
        schema:
          type: string
      responses:
        '200':
          description: user found
        '401':
          description: unauthorized
  "/api/v1/visits":
    get:
      summary: List visits
      tags:
      - Visits
      parameters:
      - name: Authorization
        in: header
        required: true
        description: Bearer token
        schema:
          type: string
      - name: start_at
        in: query
        required: false
        description: Start date (ISO 8601)
        schema:
          type: string
      - name: end_at
        in: query
        required: false
        description: End date (ISO 8601)
        schema:
          type: string
      - name: selection
        in: query
        required: false
        description: Set to "true" for area-based search
        schema:
          type: string
      - name: sw_lat
        in: query
        required: false
        description: Southwest latitude for area search
        schema:
          type: number
      - name: sw_lng
        in: query
        required: false
        description: Southwest longitude for area search
        schema:
          type: number
      - name: ne_lat
        in: query
        required: false
        description: Northeast latitude for area search
        schema:
          type: number
      - name: ne_lng
        in: query
        required: false
        description: Northeast longitude for area search
        schema:
          type: number
      responses:
        '200':
          description: visits found
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    status:
                      type: string
                      enum:
                      - suggested
                      - confirmed
                      - declined
                    started_at:
                      type: string
                      format: datetime
                    ended_at:
                      type: string
                      format: datetime
                    duration:
                      type: integer
                      description: Duration in minutes
                    place:
                      type: object
                      properties:
                        id:
                          type: integer
                        name:
                          type: string
                        latitude:
                          type: number
                        longitude:
                          type: number
                        city:
                          type: string
                        country:
                          type: string
                  required:
                  - id
                  - name
                  - status
                  - started_at
                  - ended_at
                  - duration
        '401':
          description: unauthorized
    post:
      summary: Create visit
      tags:
      - Visits
      parameters:
      - name: Authorization
        in: header
        required: true
        description: Bearer token
        schema:
          type: string
      responses:
        '200':
          description: visit created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  status:
                    type: string
                  started_at:
                    type: string
                    format: datetime
                  ended_at:
                    type: string
                    format: datetime
                  duration:
                    type: integer
                  place:
                    type: object
                    properties:
                      id:
                        type: integer
                      name:
                        type: string
                      latitude:
                        type: number
                      longitude:
                        type: number
        '422':
          description: invalid request
        '401':
          description: unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                visit:
                  type: object
                  properties:
                    name:
                      type: string
                    latitude:
                      type: number
                    longitude:
                      type: number
                    started_at:
                      type: string
                      format: datetime
                    ended_at:
                      type: string
                      format: datetime
                  required:
                  - name
                  - latitude
                  - longitude
                  - started_at
                  - ended_at
  "/api/v1/visits/{id}":
    patch:
      summary: Update visit
      tags:
      - Visits
      parameters:
      - name: id
        in: path
        required: true
        description: Visit ID
        schema:
          type: integer
      - name: Authorization
        in: header
        required: true
        description: Bearer token
        schema:
          type: string
      responses:
        '200':
          description: visit updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  status:
                    type: string
                  started_at:
                    type: string
                    format: datetime
                  ended_at:
                    type: string
                    format: datetime
                  duration:
                    type: integer
                  place:
                    type: object
        '404':
          description: visit not found
        '401':
          description: unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                visit:
                  type: object
                  properties:
                    name:
                      type: string
                    place_id:
                      type: integer
                    status:
                      type: string
                      enum:
                      - suggested
                      - confirmed
                      - declined
    delete:
      summary: Delete visit
      tags:
      - Visits
      parameters:
      - name: id
        in: path
        required: true
        description: Visit ID
        schema:
          type: integer
      - name: Authorization
        in: header
        required: true
        description: Bearer token
        schema:
          type: string
      responses:
        '204':
          description: visit deleted
        '404':
          description: visit not found
        '401':
          description: unauthorized
  "/api/v1/visits/{id}/possible_places":
    get:
      summary: Get possible places for visit
      tags:
      - Visits
      parameters:
      - name: id
        in: path
        required: true
        description: Visit ID
        schema:
          type: integer
      - name: Authorization
        in: header
        required: true
        description: Bearer token
        schema:
          type: string
      responses:
        '200':
          description: possible places found
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    latitude:
                      type: number
                    longitude:
                      type: number
                    city:
                      type: string
                    country:
                      type: string
        '404':
          description: visit not found
        '401':
          description: unauthorized
  "/api/v1/visits/merge":
    post:
      summary: Merge visits
      tags:
      - Visits
      parameters:
      - name: Authorization
        in: header
        required: true
        description: Bearer token
        schema:
          type: string
      responses:
        '200':
          description: visits merged
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  status:
                    type: string
                  started_at:
                    type: string
                    format: datetime
                  ended_at:
                    type: string
                    format: datetime
                  duration:
                    type: integer
                  place:
                    type: object
        '422':
          description: invalid request
        '401':
          description: unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                visit_ids:
                  type: array
                  items:
                    type: integer
                  minItems: 2
                  description: Array of visit IDs to merge (minimum 2)
              required:
              - visit_ids
  "/api/v1/visits/bulk_update":
    post:
      summary: Bulk update visits
      tags:
      - Visits
      parameters:
      - name: Authorization
        in: header
        required: true
        description: Bearer token
        schema:
          type: string
      responses:
        '200':
          description: visits updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  updated_count:
                    type: integer
        '422':
          description: invalid request
        '401':
          description: unauthorized
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                visit_ids:
                  type: array
                  items:
                    type: integer
                  description: Array of visit IDs to update
                status:
                  type: string
                  enum:
                  - suggested
                  - confirmed
                  - declined
                  description: New status for the visits
              required:
              - visit_ids
              - status
servers:
- url: http://{defaultHost}
  variables:
    defaultHost:
      default: localhost:3000
components:
  securitySchemes:
    api_key:
      type: apiKey
      name: api_key
      in: query
      description: API key passed as a query parameter
    bearer_auth:
      type: http
      scheme: bearer
      description: Bearer token authentication
